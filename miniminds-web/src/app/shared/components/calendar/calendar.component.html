<div class="calendar-container">
  <div class="calendar-header">
    <button class="btn btn-sm btn-outline-primary left" (click)="previousMonth()">
      <i class="bi bi-chevron-left"></i>
    </button>
    <h5 class="mb-0">{{ getMonthYear() }}</h5>
    <button class="btn btn-sm btn-outline-primary right" (click)="nextMonth()">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>

  <div class="calendar-grid">
    <div class="calendar-weekdays">
      <div class="weekday">Sun</div>
      <div class="weekday">Mon</div>
      <div class="weekday">Tue</div>
      <div class="weekday">Wed</div>
      <div class="weekday">Thu</div>
      <div class="weekday">Fri</div>
      <div class="weekday">Sat</div>
    </div>

    <div class="calendar-days">
      <div class="calendar-week" *ngFor="let week of weeks">
        <div 
          class="calendar-day"
          *ngFor="let day of week"
          [class.today]="isToday(day)"
          [class.selected]="isSelected(day)"
          [class.other-month]="!isCurrentMonth(day)"
          [class.has-event]="hasEvent(day)"
          [class.has-holiday]="hasHoliday(day)"
          (click)="selectDate(day)">
          <div class="day-number">{{ day.getDate() }}</div>
          <div class="events-container">
            <!-- Holidays -->
            <div 
              class="fc-event-container" 
              *ngFor="let holiday of getHolidaysForDay(day)">
              <div 
                class="fc-day-grid-event fc-h-event fc-event fc-start fc-end holiday-event"
                [style.background-color]="holiday.color"
                [title]="holiday.name"
                (click)="showHolidayDetails(holiday, $event)">
                <div class="fc-content">
                  <span class="fc-title">{{ holiday.name }}</span>
                </div>
              </div>
            </div>
            <!-- Events -->
            <div 
              class="fc-event-container" 
              *ngFor="let event of getEventsForDay(day); trackBy: trackByEventId">
              <div 
                class="fc-day-grid-event fc-h-event fc-event fc-start fc-end bg-info"
                [title]="event.name"
                (click)="showEventDetails(event, $event)">
                <div class="fc-content">
                  <span class="fc-title">{{ event.name }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Holiday Details Modal -->
  <div class="modal-overlay" *ngIf="showHolidayModal" (click)="closeHolidayModal()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ selectedHoliday?.name }}</h5>
          <button type="button" class="btn-close" (click)="closeHolidayModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-6"><strong>Date:</strong></div>
            <div class="col-6">{{ selectedHoliday?.date | date:'fullDate' }}</div>
          </div>
          <div class="row mt-2" *ngIf="selectedHoliday?.description">
            <div class="col-12"><strong>Description:</strong></div>
            <div class="col-12 mt-1">{{ selectedHoliday?.description }}</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeHolidayModal()">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Event Details Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeEventModal()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ selectedEvent.name }}</h5>
          <button type="button" class="btn-close" (click)="closeEventModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div *ngIf="selectedEvent.image" class="text-center mb-3">
            <img loading="lazy" [src]="selectedEvent.image" alt="Event Image" class="img-fluid rounded" style="max-width: 100%; max-height: 200px;">
          </div>
          <div *ngIf="!selectedEvent.image" class="text-center mb-3">
            <div class="bg-light rounded p-4">
              <i class="bi bi-image fs-1 text-muted"></i>
              <p class="text-muted mt-2">No image available</p>
            </div>
          </div>
          <div class="row">
            <div class="col-6"><strong>Type:</strong></div>
            <div class="col-6">{{ selectedEvent.type }}</div>
          </div>
          <div class="row mt-2">
            <div class="col-6"><strong>Date & Time:</strong></div>
            <div class="col-6">{{ selectedEvent.time | date:'medium' }}</div>
          </div>
          <div class="row mt-2">
            <div class="col-6"><strong>Price:</strong></div>
            <div class="col-6">${{ selectedEvent.price }}</div>
          </div>
          <div class="row mt-2">
            <div class="col-6"><strong>Capacity:</strong></div>
            <div class="col-6">{{ selectedEvent.capacity }}</div>
          </div>
          <div class="row mt-2">
            <div class="col-6"><strong>Age Range:</strong></div>
            <div class="col-6">{{ selectedEvent.ageFrom }} - {{ selectedEvent.ageTo }} years</div>
          </div>
          <div class="mt-3">
            <strong>Description:</strong>
            <p class="mt-1">{{ selectedEvent.description }}</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeEventModal()">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Date Events Modal -->
  <div class="modal-overlay" *ngIf="showDateEventsModal" (click)="closeDateEventsModal()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Events on {{ selectedDate | date:'fullDate' }}</h5>
          <button type="button" class="btn-close" (click)="closeDateEventsModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="list-group">
            <div *ngFor="let event of selectedDateEvents" class="list-group-item list-group-item-action" style="cursor: pointer;">
              <div class="d-flex w-100 justify-content-between align-items-center">
                <h6 class="mb-1">{{ event.name }}</h6>
                <span class="badge bg-primary">{{ event.type }}</span>
              </div>
              <p class="mb-1 text-muted"><i class="bi bi-clock me-1"></i>{{ event.time | date:'h:mm a' }}</p>
              <p class="mb-1" *ngIf="event.place"><i class="bi bi-geo-alt me-1"></i>{{ event.place }}</p>
              <small class="text-muted">{{ event.description }}</small>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeDateEventsModal()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>