<div class="container mt-4">
  <app-title-page 
    title="Edit Event" 
    subtitle="Update event information"
    icon="bi bi-pencil-square"
    [breadcrumbs]="breadcrumbs">
  </app-title-page>

  <div *ngIf="loading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div class="card card-general" *ngIf="!loading">
    <div class="card-header">
      <h5>Event Information</h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="updateEvent()">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Event Name *</label>
            <input type="text" class="form-control" [(ngModel)]="event.name" name="name" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Event Type *</label>
            <select class="form-select" [(ngModel)]="event.type" name="type" required>
              <option value="">Select Type</option>
              <option *ngFor="let type of eventTypes" [value]="type">{{ type }}</option>
            </select>
          </div>
          <div class="col-12 mb-3">
            <label class="form-label">Description *</label>
            <textarea class="form-control" [(ngModel)]="event.description" name="description" rows="3" required placeholder="Describe the event details"></textarea>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Price ($) *</label>
            <input type="number" class="form-control" [(ngModel)]="event.price" name="price" min="0" step="0.01" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Capacity *</label>
            <input type="number" class="form-control" [(ngModel)]="event.capacity" name="capacity" min="1" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Age From *</label>
            <input type="number" class="form-control" [(ngModel)]="event.ageFrom" name="ageFrom" min="0" max="18" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Age To *</label>
            <input type="number" class="form-control" [(ngModel)]="event.ageTo" name="ageTo" min="0" max="18" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Date *</label>
            <input type="date" class="form-control" [(ngModel)]="eventDate" name="eventDate" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Time *</label>
            <input type="time" class="form-control" [(ngModel)]="eventTime" name="eventTime" required>
          </div>
          <div class="col-12 mb-3">
            <label class="form-label">Place</label>
            <input type="text" class="form-control" [(ngModel)]="event.place" name="place" placeholder="Event location or venue">
          </div>
          <div class="col-12 mb-3">
            <label class="form-label">Event Image</label>
            <input type="file" class="form-control" (change)="onImageSelected($event)" accept="image/*">
            <div *ngIf="imagePreview || event.image" class="mt-2">
              <img loading="lazy" [src]="imagePreview || event.image" alt="Preview" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
              <div class="mt-2">
                <button *ngIf="imagePreview || event.image" type="button" class="btn btn-sm btn-outline-danger" (click)="removeImage()">
                  <i class="bi bi-trash"></i> Remove Image
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="d-flex gap-2 float-right">
          
          <button type="button" class="btn btn-secondary btn-cancel-global" (click)="cancel()" [disabled]="saving">Cancel</button>
          <button type="submit" class="btn btn-success btn-add-global" [disabled]="saving">
            <span *ngIf="saving" class="spinner-border spinner-border-sm me-2"></span>
            {{ saving ? 'Updating...' : 'Update Event' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<app-confirmation-modal
  [show]="showCancelModal"
  title="Leave Page?"
  message="You have unsaved changes. Are you sure you want to leave this page? All changes will be lost."
  confirmText="Leave"
  cancelText="Stay"
  (confirmed)="confirmCancel()"
  (cancelled)="closeCancelModal()">
</app-confirmation-modal>