<div *ngIf="!loading && (userRole === 'Admin' || userRole === 'Teacher')" class="container-fluid mt-4">
  <!-- Admin/Teacher Dashboard -->
  <div >
    <!-- Stats Cards -->
    <!-- Welcome Header -->

    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-dashbord_top text-white">
          <div class="card-body py-4">
            <h2 class="mb-1">{{ getGreeting() }}, {{ userName }}! üëã</h2>
            <p class="mb-0 opacity-75">{{ 'DASHBOARD.WELCOME' | translate }}</p>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
    <div class="row">
      <div class="col-xl-8 first-dashbord-card">
        <div class="row">
          <div class="col-xl-4">
            <div class="card children">
              <div class="card-body">
                <div class="percentage" >
                  <div [class.text-success]="monthlyStats.childrenChange > 0" [class.text-danger]="monthlyStats.childrenChange < 0">
                    {{ monthlyStats.childrenChange > 0 ? '+' : '' }}{{ monthlyStats.childrenChange }}%
                  </div>
                <i class="bi bi-person-fill"></i>
                </div>
                <div class="nbr">
                  {{ stats.children }}
                </div>
                <div class="title-item">
                  Children
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-4">
            <div class="card event">
              <div class="card-body">
                <div class="percentage" >
                <div [class.text-success]="monthlyStats.eventsChange > 0" [class.text-danger]="monthlyStats.eventsChange < 0">
                  {{ monthlyStats.eventsChange > 0 ? '+' : '' }}{{ monthlyStats.eventsChange }}%
                </div>
                  <i class="bi bi-person-fill"></i>
                </div>
                <div class="nbr">
                  {{ stats.events }}
                </div>
                <div class="title-item">
                  Events
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-4">
            <div class="card fee">
              <div class="card-body">
                <div class="percentage" >
                  <div [class.text-success]="monthlyStats.incomeChange > 0" [class.text-danger]="monthlyStats.incomeChange < 0">
                  {{ monthlyStats.incomeChange > 0 ? '+' : '' }}{{ monthlyStats.incomeChange }}%
                  </div>
                  <i class="bi bi-person-fill"></i>
                </div>
                <div class="nbr">
                  ${{ monthlyStats.income }}
                </div>
                <div class="title-item">
                  Income
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-6 mt-4">
            <div class="card card-dashbord-all">
              <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-people-fill"></i>Gender Distribution</h5>
              </div>
              <div class="card-body">
                <div class="chart-container text-center" style="height: 180px; width: 180px; margin: 0 auto;">
                  <canvas baseChart [data]="genderChartData" [options]="genderChartOptions" type="doughnut"></canvas>
                </div>
                <div class="mt-3 stat-style">
                  <div class="first d-flex justify-content-between">
                    <span class="circle"></span>
                    <span class="fw-bold">{{ boysCount }} ({{ boysPercentage }}%)</span>
                    <span class="text-muted">Boys</span>
                  </div>
                  <div class="second d-flex justify-content-between ">
                    <span class="circle"></span>
                    <span class="fw-bold">{{ girlsCount }} ({{ girlsPercentage }}%)</span>
                    <span class="text-muted">Girls</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-6 mt-4">
            <div class="card card-dashbord-all">
              <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-calendar2-check"></i>Weekly Attendance</h5>
              </div>
              <div class="card-body">
                <div style="position: relative; height: 200px;">
                  <canvas baseChart [data]="attendanceChartData" [options]="attendanceChartOptions" type="bar"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-12 mt-4">
            <div class="card card-recently shadow-sm card-dashbord-all">
          <div class="card-header bg-white  d-flex justify-content-between align-items-center py-3">
            <h5 class="mb-0"><i class="bi bi-person-fill-add"></i>{{ 'DASHBOARD.RECENTLY_ADDED_CHILDREN' | translate }}</h5>
            <a [routerLink]="['/children']" class="view-all btn btn-sm btn-outline-primary">{{ 'DASHBOARD.VIEW_ALL' | translate
              }}</a>
          </div>
          <div class="card-body">
            <div class="table-responsive">
							  	<table class="table table-hover">
									<tbody>
										<tr>
										  <th class="">Img</th>
										  <th>Name</th>
										  <th>Gender</th>
										  <th>Parent</th>
										  <th>Mobile</th>
										  <th class="action-recenttly">Actions</th>
										</tr>
                    <div *ngIf="recentChildren.length === 0" class="text-center text-muted py-4">
                      <i class="bi bi-inbox icon-3x mb-3 opacity-25"></i>
                      <p>{{ 'DASHBOARD.NO_CHILDREN' | translate }}</p>
                    </div>
										<tr *ngFor="let child of recentChildren">
										  <td><img loading="lazy" [src]="child.profilePicture || 'https://via.placeholder.com/50'" alt="student" class="img-fluid img-student"></td>
										  <td class="text-nowrap">{{ child.firstName }} {{child.lastName }}</td>
										  <td class="text-nowrap">{{ child.gender }}</td>
										  <td class="text-nowrap">M.Sc., PHD.</td>
										  <td>1234567890</td>
										  <td class="action-recenttly">
											  <!-- <a href="#" class="waves-effect waves-light btn btn-sm btn-primary-light btn-circle mx-5"><i class="bi bi-link"></i></a> -->
                        <button class="btn btn-sm btn-view" [routerLink]="['/children/detail', child.id]">
                        <i class="bi bi-eye"></i>
                      </button>
										  </td>
										</tr>
									</tbody>
								</table>
							</div>
          </div>
        </div>
          </div>
        </div>
      </div>
      <div class="col-xl-4">
        <div class="card calendar-dashbord shadow-sm mb-3">
          <div class="">
            <app-calendar [events]="upcomingEvents"></app-calendar>
          </div>
        </div>
        <div class="card card-recently card-dashbord-all border-0 shadow-sm mb-3">
          <div class="card-header d-flex justify-content-between align-items-center py-3">
            <h5 class="mb-0"><i class="bi bi-calendar-event-check me-2 text-info"></i>{{ 'DASHBOARD.UPCOMING_EVENTS' |
              translate }}</h5>
            <a [routerLink]="['/events']" class="view-all btn btn-sm">{{ 'DASHBOARD.VIEW_ALL' | translate }}</a>
          </div>
          <div class="card-body">
            <div *ngIf="upcomingEvents.length === 0" class="text-center text-muted py-4">
              <i class="bi bi-calendar-event-times icon-3x mb-3 opacity-25"></i>
              <p>{{ 'DASHBOARD.NO_EVENTS' | translate }}</p>
            </div>
            <div *ngFor="let event of upcomingEvents" class="event-dashbord p-3 mb-3 mt-3">
              <div class="event-card">
                <div class="date-time mb-2">
                  <div class="event-date-label">{{ event.time | date:'MMM d' }}</div>
                  <div class="event-time">{{ event.time | date:'h:mm a' }}</div>
                </div>
                <div class="event-title">{{ event.name }}</div>
                <div class="event-classes">{{ event.place }}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="card fee-dashbord border-0 shadow-sm mb-3">
          <div class="card-header bg-white  py-3">
            <h5 class="mb-0"><i class="bi bi-wallet me-2 "></i>Fee Payment Status</h5>
          </div>
          <div class="card-body">
            <div class="chart-container text-center" style="height: 180px; width: 180px; margin: 0 auto;">
              <canvas baseChart [data]="paymentChartData" [options]="paymentChartOptions" type="doughnut"></canvas>
            </div>
            <div class="mt-3 stat-style">
              <div class="d-flex justify-content-between align-items-center">
                <span class="circle blue"></span>
                <span class="text me-2">Paid</span>
                <span class="text fw-bold">{{ paymentStats.paid }}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="circle bluelight"></span>
                <span class="text me-2">Pending</span>
                <span class="text fw-bold">{{ paymentStats.pending }}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="circle red"></span>
                <span class="text me-2">Overdue</span>
                <span class="text fw-bold">{{ paymentStats.overdue }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>







    <!-- Quick Actions -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="card card-dashbord-all quick-action border-0 shadow-sm">
          <div class="card-header bg-white  py-3">
            <h5 class="mb-0"><i class="bi bi-lightning me-2 text-warning"></i>{{ 'DASHBOARD.QUICK_ACTIONS' | translate }}
            </h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <button class="btn btn-outline-primary w-100 py-3" [routerLink]="['/children/add']">
                  <i class="bi bi-person-video icon-2x d-block mb-2"></i>
                  {{ 'DASHBOARD.ADD_CHILD' | translate }}
                </button>
              </div>
              <div class="col-md-3">
                <button class="btn btn-outline-success w-100 py-3" [routerLink]="['/parent/add']">
                  <i class="bi bi-person-add icon-2x d-block mb-2"></i>
                  {{ 'DASHBOARD.ADD_PARENT' | translate }}
                </button>
              </div>
              <div class="col-md-3">
                <button class="btn btn-outline-info w-100 py-3" [routerLink]="['/events/add']">
                  <i class="bi bi-calendar2-event icon-2x d-block mb-2"></i>
                  {{ 'DASHBOARD.CREATE_EVENT' | translate }}
                </button>
              </div>
              <div class="col-md-3">
                <button class="btn btn-outline-warning w-100 py-3" [routerLink]="['/calendar']">
                  <i class="bi bi-calendar-event icon-2x d-block mb-2"></i>
                  {{ 'DASHBOARD.VIEW_CALENDAR' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Parent Dashboard -->
<div class="parent">
  <div *ngIf="!loading && userRole === 'Parent'">
    <!-- New Design -->
    <div class="parent-dashboard-new">
      <!-- Header Section -->
      <div class="dashboard-header">
        <div class="header-content">
          <div class="row welcome-text">
              <div class="col-10">
                <h2 class="mb-1 mt-4 welcome font-inter">{{ getGreeting() }}, {{ userName }}! üëã</h2>
                <p class="mb-0 black font-inter ">Miniminds Home</p>
              </div>
              <div class="col-2">
                <img [src]="userProfilePicture || 'assets/default-avatar.svg'" 
                     [alt]="userName" 
                     class="rounded-circle profile-image img-fluid" 
                     (click)="goToParentProfile()"
                     style="cursor: pointer;">
              </div>
            </div>
          
        </div>
        <!-- Child Status Card with Slider -->
        <div [class]="myChildren.length > 1 ? 'child-status-card' : 'child-status-card one'" class="child-status-card" *ngIf="myChildren.length > 0">
          <div  [class]="myChildren.length > 1 ? 'card-header-row' : 'one-child'">
            <h2 class="section-title" *ngIf="myChildren.length > 1">Child Status</h2>
            <div class="slider-controls" *ngIf="myChildren.length > 1">
              <button class="slider-btn" (click)="prevChild()" [disabled]="selectedChildIndex === 0">
                <i class="bi bi-chevron-left"></i>
              </button>
              <span class="child-counter">{{ selectedChildIndex + 1 }}/{{ myChildren.length }}</span>
              <button class="slider-btn" (click)="nextChild()" [disabled]="selectedChildIndex === myChildren.length - 1">
                <i class="bi bi-chevron-right"></i>
              </button>
            </div>
            <button class="info-btn" [routerLink]="['/children/detail', getSelectedChild()?.id]">
              <i class="bi bi-info-circle"></i>
            </button>
          </div>
          <div class="child-info" [routerLink]="['/children/detail', getSelectedChild()?.id]" style="cursor: pointer;">
            <img [src]="getSelectedChild()?.profilePicture || 'assets/default-avatar.svg'" [alt]="getSelectedChild()?.firstName" class="child-avatar">
            <div class="child-details">
              <h3 class="child-name">{{ getSelectedChild()?.firstName }} {{ getSelectedChild()?.lastName }}</h3>
              <p class="child-age">{{ getAge(getSelectedChild()?.dateOfBirth) }} old</p>
              <p class="check-in-time">{{ getCheckInStatus(getSelectedChild()) }}</p>
            </div>
          </div>
          <!-- Child Dots Indicator -->
          <div class="child-dots" *ngIf="myChildren.length > 1">
            <span 
              *ngFor="let child of myChildren; let i = index" 
              class="dot" 
              [class.active]="i === selectedChildIndex"
              (click)="selectChild(i)">
            </span>
          </div>
        </div>
      </div>

      

      <!-- Today Stats -->
      <div class="today-stats">
        <h2 class="section-title">Today Stats - {{ getSelectedChildName() }}</h2>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-icon-wrapper">
              <span class="stat-icon">üçé</span>
            </div>
            <div class="stat-info">
              <h4 class="stat-label">Meals</h4>
              <p class="stat-value">({{ todayStats.meals.completed }}/{{ todayStats.meals.total }} completed)</p>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon-wrapper">
              <span class="stat-icon">üåô</span>
            </div>
            <div class="stat-info">
              <h4 class="stat-label">Nap time</h4>
              <p class="stat-value">({{ todayStats.napTime }})</p>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon-wrapper">
              <span class="stat-icon">üé®</span>
            </div>
            <div class="stat-info">
              <h4 class="stat-label">Activities</h4>
              <p class="stat-value">({{ todayStats.activities }} completed)</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <!-- <div class="quick-actions">
        <h2 class="section-title">Quick Actions</h2>
        <div class="actions-scroll">
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/messages']">
              <i class="bi bi-chat-dots-fill"></i>
            </button>
            <span>Message</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/reclamations']">
              <i class="bi bi-exclamation-circle-fill"></i>
            </button>
            <span>Reclamations</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/calendar']">
              <i class="bi bi-calendar3"></i>
            </button>
            <span>Calendar</span>
          </div>
          <div class="action-item_btn">
              <button class="action-btn" [routerLink]="['/fees']">
                <i class="bi bi-credit-card"></i>
              </button>
              <span>Payments</span>
          </div>
          <div class="action-item_btn">
            <div class="action-item_btn">
              <button class="action-btn" [routerLink]="['/activities']">
                <i class="bi bi-clipboard-data"></i>
              </button>
              <span>Activities</span>
            </div>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/events']">
              <i class="bi bi-calendar-event"></i>
            </button>
            <span>Events</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/attendance']">
              <i class="bi bi-calendar-check"></i>
            </button>
            <span>Attendance</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/profile']">
              <i class="bi bi-person-circle"></i>
            </button>
            <span>Profile</span>
          </div>
        </div>
      </div> -->

      <!-- Activities Timeline -->
      <div class="activities-section">
        <h2 class="section-title">Activities - {{ getSelectedChildName() }}</h2>
          <div class="event-card" *ngIf="todayActivities.length == 0">
            <div class="card card-general">
              <div class="card-body text-center text-muted py-4">
                <i class="bi bi-calendar-x icon-3x mb-3 opacity-25"></i>
                <p class="mb-0">Today's still no activity</p>
              </div>
            </div>
          </div>
        <div class="timeline">
          <div class="timeline-item" *ngFor="let activity of todayActivities">
            <div class="timeline-marker active"></div>
            <div class="timeline-content">
              <p class="timeline-time">{{ activity.activityTime | date:'h:mm a' }}: {{ activity.activityType }}</p>
              <p class="activity-notes" *ngIf="activity.notes">{{ activity.notes }}</p>
              <p class="activity-duration" *ngIf="activity.duration">Duration: {{ activity.duration }}</p>
              <p class="activity-food" *ngIf="activity.foodItem">Food: {{ activity.foodItem }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Upcoming Events -->
      <div class="upcoming-events">
        <h2 class="section-title">Upcoming Events</h2>
        <div class="card card-general" *ngIf="upcomingEvents.length == 0">
          <div class="text-center">
        
            <div class="card-body text-center text-muted py-4">
              <i class="bi bi-calendar-x icon-3x mb-3 opacity-25"></i>
              <p class="mb-0">No upcoming events</p>
            </div>
          </div>
        </div>
        <div class="event-card" *ngFor="let event of upcomingEvents" [routerLink]="['/events/detail', event.id]" style="cursor: pointer;">
          <div class="event-icon">
            <i class="bi bi-calendar-event"></i>
          </div>
          <div class="event-details">
            <h4 class="event-title">{{ event.name }}</h4>
            <p class="event-date">{{ event.time | date:'MMM d, yyyy' }}</p>
            <p class="event-place" *ngIf="event.place">{{ event.place }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- OLD DESIGN (COMMENTED OUT) -->
    <!--
    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-dashbord_topparent mb-4">
          <div class="card-body py-4">
            <div class="row welcome-text">
              <div class="col-10">
                <h2 class="mb-1 welcome font-inter">{{ getGreeting() }}, {{ userName }}! üëã</h2>
                <p class="mb-0 black font-inter ">Miniminds Home</p>
              </div>
              <div class="col-2">
                <img [src]="userProfilePicture || 'assets/default-avatar.svg'" 
                     [alt]="userName" 
                     class="rounded-circle profile-image img-fluid" 
                     [routerLink]="['/profile']">
              </div>
            </div>
          



            <div *ngIf="myChildren.length === 0" class="text-center text-muted py-4">
              <i class="bi bi-inbox icon-3x mb-3 opacity-25"></i>
              <p>No children found</p>
            </div>
            <div class="row childinformation_dashbord" *ngIf="myChildren.length > 0">
              <div class="" *ngFor="let child of myChildren">
                <div class="card  child-dashbord">
                  <div class="card-body d-flex">
                    <div class="child-image me-2">
                      <img [src]="child.profilePicture || 'assets/default-avatar.svg'" 
                          [alt]="child.firstName" 
                          class=""
                          style="width: 60px; height: 60px; object-fit: cover;">
                    </div>
                    <div class="child-detail_dashbord">
                      <h6 class="mb-1">{{ child.firstName }} {{ child.lastName }}</h6>
                      <span>{{ getCheckInStatus(child) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>




          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="menu-section mb-4 mt-5">
        <h4 class="mb-3">Categories</h4>
        <div class="menu-scroll-container">
          <div class="menu-grid">
            <div class="menu-item">
              <div class="card border-0 shadow-sm menu-card" [routerLink]="['/events']" style="cursor: pointer;">
                <div class="card-body text-center py-3">
                  <i class="bi bi-calendar-event" style="font-size: 2.5rem; color: #667eea;"></i>
                  <h6 class="mt-2 mb-0" style="color: #667eea;">Events</h6>
                </div>
              </div>
            </div>
            <div class="menu-item">
              <div class="card border-0 shadow-sm menu-card" [routerLink]="['/calendar']" style="cursor: pointer;">
                <div class="card-body text-center py-3">
                  <i class="bi bi-calendar3" style="font-size: 2.5rem; color: #f5576c;"></i>
                  <h6 class="mt-2 mb-0" style="color: #f5576c;">Calendar</h6>
                </div>
              </div>
            </div>
            <div class="menu-item">
              <div class="card border-0 shadow-sm menu-card" [routerLink]="['/holidays']" style="cursor: pointer;">
                <div class="card-body text-center py-3">
                  <i class="bi bi-sun" style="font-size: 2.5rem; color: #4facfe;"></i>
                  <h6 class="mt-2 mb-0" style="color: #4facfe;">Holidays</h6>
                </div>
              </div>
            </div>
            <div class="menu-item">
              <div class="card border-0 shadow-sm menu-card" [routerLink]="['/fees']" style="cursor: pointer;">
                <div class="card-body text-center py-3">
                  <i class="bi bi-wallet2" style="font-size: 2.5rem; color: #43e97b;"></i>
                  <h6 class="mt-2 mb-0" style="color: #43e97b;">Fees</h6>
                </div>
              </div>
            </div>
            <div class="menu-item">
              <div class="card border-0 shadow-sm menu-card" [routerLink]="['/games']" style="cursor: pointer;">
                <div class="card-body text-center py-3">
                  <i class="bi bi-controller" style="font-size: 2.5rem; color: #fa709a;"></i>
                  <h6 class="mt-2 mb-0" style="color: #fa709a;">Games</h6>
                </div>
              </div>
            </div>
            <div class="menu-item">
              <div class="card border-0 shadow-sm menu-card" [routerLink]="['/children']" style="cursor: pointer;">
                <div class="card-body text-center py-3">
                  <i class="bi bi-people" style="font-size: 2.5rem; color: #30cfd0;"></i>
                  <h6 class="mt-2 mb-0" style="color: #30cfd0;">My Children</h6>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="today-stats-section mb-4">
        <h4 class="mb-3"><i class="bi bi-graph-up me-2"></i>Today Stats</h4>
        <div class="row g-3">
          <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm stat-card">
              <div class="card-body text-center py-3">
                <i class="bi bi-person-check" style="font-size: 2rem; color: #43e97b;"></i>
                <h3 class="mt-2 mb-0" style="color: #43e97b;">12</h3>
                <p class="mb-0 small text-muted">Present</p>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm stat-card">
              <div class="card-body text-center py-3">
                <i class="bi bi-person-x" style="font-size: 2rem; color: #f5576c;"></i>
                <h3 class="mt-2 mb-0" style="color: #f5576c;">2</h3>
                <p class="mb-0 small text-muted">Absent</p>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm stat-card">
              <div class="card-body text-center py-3">
                <i class="bi bi-calendar-check" style="font-size: 2rem; color: #667eea;"></i>
                <h3 class="mt-2 mb-0" style="color: #667eea;">3</h3>
                <p class="mb-0 small text-muted">Events</p>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm stat-card">
              <div class="card-body text-center py-3">
                <i class="bi bi-bell" style="font-size: 2rem; color: #fa709a;"></i>
                <h3 class="mt-2 mb-0" style="color: #fa709a;">5</h3>
                <p class="mb-0 small text-muted">Notifications</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    -->
  </div>
</div>