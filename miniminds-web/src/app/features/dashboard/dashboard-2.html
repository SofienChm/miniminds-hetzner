<div *ngIf="!loading && (userRole === 'Admin' || userRole === 'Teacher')" class="container-fluid mt-4">
  <!-- Admin/Teacher Dashboard -->
  <div>
    <!-- Stats Cards -->
    <!-- Welcome Header -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    <div class="row g-2">
      <div class="col-5">
        <div class="row g-2">
          <div class="col-12">
            <div class="card card-dashbord_top text-white">
              <div class="card-body py-3">
                <h2 class="mb-1">{{ getGreeting() }}, {{ userName }}! üëã</h2>
                <p class="mb-0 opacity-75">{{ 'DASHBOARD.WELCOME' | translate }}</p>
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="card stat-card">
              <div class="card-body d-flex align-items-center p-4">
                <div class="stat-icon-wrapper me-3">
                  <i class="bi bi-people-fill"></i>
                </div>
                <div class="stat-content">
                  <h3 class="stat-number mb-1">{{ stats.children }}</h3>
                  <p class="stat-label mb-0">Children</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="card stat-card">
              <div class="card-body d-flex align-items-center p-4">
                <div class="stat-icon-wrapper me-3">
                  <i class="bi bi-people-fill"></i>
                </div>
                <div class="stat-content">
                  <h3 class="stat-number mb-1">{{ stats.children }}</h3>
                  <p class="stat-label mb-0">Children</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="card stat-card">
              <div class="card-body d-flex align-items-center p-4">
                <div class="stat-icon-wrapper me-3">
                  <i class="bi bi-people-fill"></i>
                </div>
                <div class="stat-content">
                  <h3 class="stat-number mb-1">{{ stats.children }}</h3>
                  <p class="stat-label mb-0">Children</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="card stat-card">
              <div class="card-body d-flex align-items-center p-4">
                <div class="stat-icon-wrapper me-3">
                  <i class="bi bi-people-fill"></i>
                </div>
                <div class="stat-content">
                  <h3 class="stat-number mb-1">{{ stats.children }}</h3>
                  <p class="stat-label mb-0">Children</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-7">
        <div class="card card-attendance">
          <div class="card-body">
            <h5 class="card-title mb-3">Weekly Attendance</h5>
            <div style="height: 300px;">
              <canvas baseChart
                [data]="attendanceBarChartData"
                [options]="attendanceBarChartOptions"
                type="bar">
              </canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-4">
        <div class="card calendar-dashbord shadow-sm mb-3 mt-4">
          <div class="">
            <app-calendar [events]="upcomingEvents"></app-calendar>
          </div>
        </div>
      </div>
      <div class="col-4">
        <div class="card upcoming-events-container shadow-sm mb-3 mt-4">
          <div class="card-header bg-white py-3">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-calendar-event me-2"></i>Upcoming Events</h5>
              <a [routerLink]="['/events']" class="btn btn-sm btn-outline-primary" style="border-color: #0E567D; color: #0E567D;">View All</a>
            </div>
          </div>
          <div class="card-body">
            <div class="events-list">
              <div *ngIf="upcomingEvents.length === 0" class="text-center text-muted py-4">
                <i class="bi bi-calendar-x" style="font-size: 3rem; opacity: 0.3;"></i>
                <p class="mt-2 mb-0">No upcoming events</p>
              </div>
              <div *ngFor="let event of upcomingEvents" class="event-item mb-3" [routerLink]="['/events/detail', event.id]" style="cursor: pointer;">
                <div class="d-flex align-items-center p-3 bg-light rounded">
                  <div class="event-icon me-3">
                    <div class="icon-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-calendar-event" style="color: rgb(43 94 169) !important; font-size: 1.2rem;"></i>
                    </div>
                  </div>
                  <div class="event-content flex-grow-1">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                      <h6 class="event-name mb-0 fw-bold">{{ event.name }}</h6>
                      <span class="badge bg-primary">{{ event.type }}</span>
                    </div>
                    <div class="event-details">
                      <small class="text-muted d-block">
                        <i class="bi bi-clock me-1"></i>{{ event.time | date:'MMM d, yyyy - h:mm a' }}
                      </small>
                      <small class="text-muted" *ngIf="event.place">
                        <i class="bi bi-geo-alt me-1"></i>{{ event.place }}
                      </small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-4">
        <div class="quick-actions-container bg-white p-3 mb-3 mt-4">
          <div class="mb-3">
            <h5 class="mb-0">Quick Links</h5>
          </div>
          <div class="row g-1">
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/children/add']" style="cursor: pointer;">
                <i class="bi bi-person-plus-fill"></i>
                <small>Add Child</small>
              </div>
            </div>
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/children']" style="cursor: pointer;">
                <i class="bi bi-people-fill" ></i>
                <small>Children List</small>
              </div>
            </div>
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/leaves/add']" style="cursor: pointer;">
                <i class="bi bi-calendar-plus"></i>
                <small>Add Leave</small>
              </div>
            </div>
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/daily-activities']" style="cursor: pointer;">
                <i class="bi bi-clipboard-data"></i>
                <small>Daily Reports</small>
              </div>
            </div>
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/fees']" style="cursor: pointer;">
                <i class="bi bi-credit-card"></i>
                <small>Payments</small>
              </div>
            </div>
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/reclamations']" style="cursor: pointer;">
                <i class="bi bi-exclamation-triangle"></i>
                <small>Reclamations</small>
              </div>
            </div>
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/reclamations']" style="cursor: pointer;">
                <i class="bi bi-exclamation-triangle"></i>
                <small>Reclamations</small>
              </div>
            </div>
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/reclamations']" style="cursor: pointer;">
                <i class="bi bi-exclamation-triangle"></i>
                <small>Reclamations</small>
              </div>
            </div>
            <div class="col-4 items">
              <div class="card quick-action-card text-center p-3" [routerLink]="['/reclamations']" style="cursor: pointer;">
                <i class="bi bi-exclamation-triangle"></i>
                <small>Reclamations</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Parent Dashboard -->
<div class="parent">
  <div *ngIf="!loading && userRole === 'Parent'">
    <!-- New Design -->
    <div class="parent-dashboard-new">
      <!-- Header Section -->
      <div class="dashboard-header">
        <div class="header-content">
          <div class="row welcome-text">
            <div class="col-10">
              <h2 class="mb-1 mt-4 welcome font-inter">{{ getGreeting() }}, {{ userName }} ! üëã</h2>
              <p class="mb-0 black font-inter ">Miniminds Home</p>
            </div>
            <div class="col-2">
              <img [src]="userProfilePicture || 'assets/default-avatar.svg'" [alt]="userName"
                class="rounded-circle profile-image img-fluid" (click)="goToParentProfile()" style="cursor: pointer;">
            </div>
          </div>

        </div>
        <!-- Child Status Card with Slider -->
        <div [class]="myChildren.length > 1 ? 'child-status-card' : 'child-status-card one'" class="child-status-card" *ngIf="myChildren.length > 0">
          <div  [class]="myChildren.length > 1 ? 'card-header-row' : 'one-child'">
            <h2 class="section-title" *ngIf="myChildren.length > 1">Child Status</h2>
            <div class="slider-controls" *ngIf="myChildren.length > 1">
              <button class="slider-btn" (click)="prevChild()" [disabled]="selectedChildIndex === 0">
                <i class="bi bi-chevron-left"></i>
              </button>
              <span class="child-counter">{{ selectedChildIndex + 1 }}/{{ myChildren.length }}</span>
              <button class="slider-btn" (click)="nextChild()"
                [disabled]="selectedChildIndex === myChildren.length - 1">
                <i class="bi bi-chevron-right"></i>
              </button>
            </div>
            <button class="info-btn" [routerLink]="['/children/detail', getSelectedChild()?.id]">
              <i class="bi bi-info-circle"></i>
            </button>
          </div>
          <div class="child-info" [routerLink]="['/children/detail', getSelectedChild()?.id]" style="cursor: pointer;">
            <img [src]="getSelectedChild()?.profilePicture || 'assets/child.png'"
              [alt]="getSelectedChild()?.firstName" class="child-avatar">
            <div class="child-details">
              <h3 class="child-name">{{ getSelectedChild()?.firstName }} {{ getSelectedChild()?.lastName }}</h3>
              <p class="child-age">{{ getAge(getSelectedChild()?.dateOfBirth) }} old</p>
              <p class="check-in-time">{{ getCheckInStatus(getSelectedChild()) }}</p>
            </div>
          </div>
          <!-- Child Dots Indicator -->
          <div class="child-dots" *ngIf="myChildren.length > 1">
            <span *ngFor="let child of myChildren; let i = index" class="dot" [class.active]="i === selectedChildIndex"
              (click)="selectChild(i)">
            </span>
          </div>
        </div>
      </div>

      
      <div class="container-fluid">
        <!-- Today Stats -->
        <div class="today-stats">
          <h2 class="section-title">Today Stats - {{ getSelectedChildName() }}</h2>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-icon-wrapper">
                <span class="stat-icon">üçé</span>
              </div>
              <div class="stat-info">
                <h4 class="stat-label">Meals</h4>
                <p class="stat-value">({{ todayStats.meals.completed }}/{{ todayStats.meals.total }} completed)</p>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon-wrapper">
                <span class="stat-icon">üåô</span>
              </div>
              <div class="stat-info">
                <h4 class="stat-label">Nap time</h4>
                <p class="stat-value">({{ todayStats.napTime }})</p>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon-wrapper">
                <span class="stat-icon">üé®</span>
              </div>
              <div class="stat-info">
                <h4 class="stat-label">Activities</h4>
                <p class="stat-value">({{ todayStats.activities }} completed)</p>
              </div>
            </div>
          </div>
        </div>
        <!-- Activities Timeline -->
        <div class="activities-section">
          <h2 class="section-title">Activities - {{ getSelectedChildName() }}</h2>
            <div class="event-card" *ngIf="todayActivities.length == 0">
              <div class="card card-general">
                <div class="card-body text-center text-muted py-4">
                  <i class="bi bi-calendar-x icon-3x mb-3 opacity-25"></i>
                  <p class="mb-0">Today's still no activity</p>
                </div>
              </div>
            </div>
          <div class="timeline">
            <div class="timeline-item clickable-activity"
                 *ngFor="let activity of todayActivities"
                 [routerLink]="['/activities/detail', activity.id]"
                 style="cursor: pointer;">
              <div class="timeline-marker active"></div>
              <div class="timeline-content">
                <div class="activity-info">
                  <p class="timeline-time">{{ activity.activityTime | date:'h:mm a' }}: {{ activity.activityType }}</p>
                  <p class="activity-notes" *ngIf="activity.notes">{{ activity.notes }}</p>
                  <p class="activity-duration" *ngIf="activity.duration">Duration: {{ activity.duration }}</p>
                  <p class="activity-food" *ngIf="activity.foodItem">Food: {{ activity.foodItem }}</p>
                </div>
                <i class="bi bi-chevron-right activity-arrow"></i>
              </div>
            </div>
          </div>
        </div>
        <!-- Upcoming Events -->
        <div class="upcoming-events">
          <h2 class="section-title">Upcoming Events</h2>
          <div class="card card-general" *ngIf="upcomingEvents.length == 0">
            <div class="text-center">
          
              <div class="card-body text-center text-muted py-4">
                <i class="bi bi-calendar-x icon-3x mb-3 opacity-25"></i>
                <p class="mb-0">No upcoming events</p>
              </div>
            </div>
          </div>
          <div class="event-card" *ngFor="let event of upcomingEvents" [routerLink]="['/events/detail', event.id]" style="cursor: pointer;">
            <div class="event-icon">
              <i class="bi bi-calendar-event"></i>
            </div>
            <div class="event-details">
              <h4 class="event-title">{{ event.name }}</h4>
              <p class="event-date">{{ event.time | date:'MMM d, yyyy' }}</p>
              <p class="event-place" *ngIf="event.place">{{ event.place }}</p>
            </div>
          </div>
        </div>
        <!-- Recent Photos -->
        <div class="recent-photos-section">
          <h2 class="section-title">Recent Photos - {{ getSelectedChildName() }}</h2>
          <div class="card card-general" *ngIf="recentPhotos.length === 0">
            <div class="card-body text-center text-muted py-4">
              <i class="bi bi-images icon-3x mb-3 opacity-25"></i>
              <p class="mb-0">No photos yet</p>
            </div>
          </div>
          <div class="photos-grid" *ngIf="recentPhotos.length > 0">
            <div class="photo-item" *ngFor="let photo of recentPhotos" [routerLink]="['/gallery']">
              <img [src]="photo.thumbnailData || photo.imageData || 'assets/placeholder.jpg'"
                   [alt]="photo.title || 'Child photo'"
                   class="photo-img">
              <div class="photo-overlay">
                <i class="bi bi-eye-fill"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <!-- <div class="quick-actions">
        <h2 class="section-title">Quick Actions</h2>
        <div class="actions-scroll">
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/messages']">
              <i class="bi bi-chat-dots-fill"></i>
            </button>
            <span>Message</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/reclamations']">
              <i class="bi bi-exclamation-circle-fill"></i>
            </button>
            <span>Reclamations</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/calendar']">
              <i class="bi bi-calendar3"></i>
            </button>
            <span>Calendar</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/fees']">
              <i class="bi bi-credit-card"></i>
            </button>
            <span>Payments</span>
          </div>
          <div class="action-item_btn">
            <div class="action-item_btn">
              <button class="action-btn" [routerLink]="['/activities']">
                <i class="bi bi-clipboard-data"></i>
              </button>
              <span>Activities</span>
            </div>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/events']">
              <i class="bi bi-calendar-event"></i>
            </button>
            <span>Events</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/attendance']">
              <i class="bi bi-calendar-check"></i>
            </button>
            <span>Attendance</span>
          </div>
          <div class="action-item_btn">
            <button class="action-btn" [routerLink]="['/profile']">
              <i class="bi bi-person-circle"></i>
            </button>
            <span>Profile</span>
          </div>
        </div>
      </div> -->

      <!-- Activities Timeline -->
      <div class="activities-section">
        <h2 class="section-title">Activities - {{ getSelectedChildName() }}</h2>
        <div class="event-card" *ngIf="todayActivities.length == 0">
          <div class="card card-general">
            <div class="card-body text-center text-muted py-4">
              <i class="bi bi-calendar-x icon-3x mb-3 opacity-25"></i>
              <p class="mb-0">Today's still no activity</p>
            </div>
          </div>
        </div>
        <div class="timeline">
          <div class="timeline-item" *ngFor="let activity of todayActivities">
            <div class="timeline-marker active"></div>
            <div class="timeline-content">
              <p class="timeline-time">{{ activity.activityTime | date:'h:mm a' }}: {{ activity.activityType }}</p>
              <p class="activity-notes" *ngIf="activity.notes">{{ activity.notes }}</p>
              <p class="activity-duration" *ngIf="activity.duration">Duration: {{ activity.duration }}</p>
              <p class="activity-food" *ngIf="activity.foodItem">Food: {{ activity.foodItem }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Upcoming Events -->
      <div class="upcoming-events">
        <h2 class="section-title">Upcoming Events</h2>
        <div class="card card-general" *ngIf="upcomingEvents.length == 0">
          <div class="text-center">

            <div class="card-body text-center text-muted py-4">
              <i class="bi bi-calendar-x icon-3x mb-3 opacity-25"></i>
              <p class="mb-0">No upcoming events</p>
            </div>
          </div>
        </div>
        <div class="event-card" *ngFor="let event of upcomingEvents" [routerLink]="['/events/detail', event.id]"
          style="cursor: pointer;">
          <div class="event-icon">
            <i class="bi bi-calendar-event"></i>
          </div>
          <div class="event-details">
            <h4 class="event-title">{{ event.name }}</h4>
            <p class="event-date">{{ event.time | date:'MMM d, yyyy' }}</p>
            <p class="event-place" *ngIf="event.place">{{ event.place }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>